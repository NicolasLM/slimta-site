

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>slimta.relay.smtp.mx &mdash; slimta 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/cloud.js"></script>
    <link rel="top" title="slimta 2.0.0 documentation" href="../index.html" />
    <link rel="up" title="slimta.relay.smtp" href="slimta.relay.smtp.html" />
    <link rel="next" title="slimta.relay.http" href="slimta.relay.http.html" />
    <link rel="prev" title="slimta.relay.smtp.static" href="slimta.relay.smtp.static.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.relay.http.html" title="slimta.relay.http"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.relay.smtp.static.html" title="slimta.relay.smtp.static"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">slimta 2.0.0 documentation</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../api.html" >API Reference</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="slimta.html" >slimta</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="slimta.relay.html" >slimta.relay</a> &raquo;</li>
          <li class="nav-item nav-item-4"><a href="slimta.relay.smtp.html" accesskey="U">slimta.relay.smtp</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-slimta.relay.smtp.mx">
<span id="slimta-relay-smtp-mx"></span><h1>slimta.relay.smtp.mx<a class="headerlink" href="#module-slimta.relay.smtp.mx" title="Permalink to this headline">¶</a></h1>
<p>Implements an algorithm to query and pick an MX record to delivery a
message.  The MX record is calculated by pulling the domain-name from the
recipient&#8217;s email address (or first recipient, if multiple) and querying DNS
for the domain MX email routing records. If multiple records exist, the pick is
made by using the number of delivery attempts to cycle through the options.</p>
<dl class="class">
<dt id="slimta.relay.smtp.mx.MxSmtpRelay">
<em class="property">class </em><code class="descclassname">slimta.relay.smtp.mx.</code><code class="descname">MxSmtpRelay</code><span class="sig-paren">(</span><span class="optional">[</span><em>**client_kwargs</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#slimta.relay.smtp.mx.MxSmtpRelay" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="slimta.relay.html#slimta.relay.Relay" title="slimta.relay.Relay"><code class="xref py py-class docutils literal"><span class="pre">slimta.relay.Relay</span></code></a></p>
<p>Delivers messages based on the MX records of their recipients. Keeps an
expiring cache of resolved MX records to prevent DNS overuse, and uses a
<a class="reference internal" href="slimta.relay.smtp.static.html#slimta.relay.smtp.static.StaticSmtpRelay" title="slimta.relay.smtp.static.StaticSmtpRelay"><code class="xref py py-class docutils literal"><span class="pre">StaticSmtpRelay</span></code></a> object for each
destination to recycle and limit connections.</p>
<p>All arguments are optional.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tls</strong> &#8211; Optional dictionary of TLS settings passed directly as
keyword arguments to <code class="xref py py-class docutils literal"><span class="pre">gevent.ssl.SSLSocket</span></code>.</li>
<li><strong>tls_required</strong> &#8211; If given and True, it should be considered a delivery
failure if TLS cannot be negotiated by the client.</li>
<li><strong>connect_timeout</strong> &#8211; Timeout in seconds to wait for a client connection
to be successful before issuing a transient
failure.</li>
<li><strong>command_timeout</strong> &#8211; Timeout in seconds to wait for a reply to each SMTP
command before issuing a transient failure.</li>
<li><strong>data_timeout</strong> &#8211; Timeout in seconds to wait for a reply to message data
before issuing a transient failure.</li>
<li><strong>idle_timeout</strong> &#8211; Timeout in seconds after a message is delivered before
a QUIT command is sent and the connection terminated.
If another message should be delivered before this
timeout expires, the connection will be re-used. By
default, QUIT is sent immediately and connections are
never re-used.</li>
<li><strong>ehlo_as</strong> &#8211; The string to send as the EHLO or HELO string. Defaults to
the FQDN of the system. This may also be given as a
function that will be executed with the destination address
at the beginning of each connection.</li>
<li><strong>binary_encoder</strong> &#8211; Optional function from <a class="reference external" href="http://docs.python.org/library/email.encoders.html#module-email.encoders" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">email.encoders</span></code></a> used as
an argument to
<a class="reference internal" href="slimta.envelope.html#slimta.envelope.Envelope.encode_7bit" title="slimta.envelope.Envelope.encode_7bit"><code class="xref py py-meth docutils literal"><span class="pre">encode_7bit()</span></code></a> when
conversion is necessary for the remote server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="slimta.relay.smtp.mx.MxSmtpRelay.new_static_relay">
<code class="descname">new_static_relay</code><span class="sig-paren">(</span><em>destination</em>, <em>port</em><span class="sig-paren">)</span><a class="headerlink" href="#slimta.relay.smtp.mx.MxSmtpRelay.new_static_relay" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new <a class="reference internal" href="slimta.relay.smtp.static.html#slimta.relay.smtp.static.StaticSmtpRelay" title="slimta.relay.smtp.static.StaticSmtpRelay"><code class="xref py py-class docutils literal"><span class="pre">StaticSmtpRelay</span></code></a>
object for the given destination. This method can be overriden to
provide extra arguments, such as limiting the number of concurrent
connections.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>destination</strong> &#8211; The hostname to relay to.</li>
<li><strong>port</strong> &#8211; The delivery port on the destination.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="slimta.relay.smtp.mx.MxSmtpRelay.choose_mx">
<code class="descname">choose_mx</code><span class="sig-paren">(</span><em>records</em>, <em>attempts</em><span class="sig-paren">)</span><a class="headerlink" href="#slimta.relay.smtp.mx.MxSmtpRelay.choose_mx" title="Permalink to this definition">¶</a></dt>
<dd><p>Chooses a record based on the number of delivery attempts on the
message. As provided, this method cycle through the records trying
each one once, but this method can be overriden.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>records</strong> &#8211; List of tuples <code class="docutils literal"><span class="pre">(pref,</span> <span class="pre">host)</span></code> sorted by preference.</li>
<li><strong>attempts</strong> &#8211; The number of delivery attempts this message has
undergone.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The <code class="docutils literal"><span class="pre">host</span></code> that was picked from the list.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)">str</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="slimta.relay.smtp.mx.MxSmtpRelay.force_mx">
<code class="descname">force_mx</code><span class="sig-paren">(</span><em>domain</em>, <em>destination</em><span class="optional">[</span>, <em>port=25</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#slimta.relay.smtp.mx.MxSmtpRelay.force_mx" title="Permalink to this definition">¶</a></dt>
<dd><p>Do not do MX record lookups for the given <code class="docutils literal"><span class="pre">domain</span></code>, instead always
use <code class="docutils literal"><span class="pre">destination</span></code> for delivery.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>domain</strong> &#8211; Domain to force.</li>
<li><strong>destination</strong> &#8211; Destination hostname.</li>
<li><strong>port</strong> &#8211; Port number on the destination.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html" title="index">
          <img class="logo" src="../_static/slimta.svg" alt="Logo"/>
        </a></p>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="slimta.relay.smtp.static.html"
                          title="Previous page">&larr; slimta.relay.smtp.static</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="slimta.relay.http.html"
                          title="Next page">&rarr; slimta.relay.http</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.relay.http.html" title="slimta.relay.http"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="slimta.relay.smtp.static.html" title="slimta.relay.smtp.static"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">slimta 2.0.0 documentation</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../api.html" >API Reference</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="slimta.html" >slimta</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="slimta.relay.html" >slimta.relay</a> &raquo;</li>
          <li class="nav-item nav-item-4"><a href="slimta.relay.smtp.html" >slimta.relay.smtp</a> &raquo;</li> 
      </ul>
    </div>
    </div>


    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Ian Good.
    </div>
    <!-- cloud_sptheme 1.4 -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-60327323-1', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript">
  document._EUGO = 'ff80897801813c8394e7';
  document.head.appendChild(function() {
    var s = document.createElement('script');
    s.src = 'https://eugo.ws/eugo.js';
    s.async = 1;
    return s;
  }());
</script>

  </body>
</html>